define(["jquery","core/ajax","core/str"],function(a,b,c){return{init:function(){var d={};d.str={},d.iconDisplay=function(b){var c=a(d.starlink).find("img.icon"),e=a(c).attr("src"),f=e.match(/^(.*\/)(star|star-o)$/),g=e;g=b?f[1]+"star":f[1]+"star-o",c.attr("src",g)},d.textAction=function(){var b=d.courseState?d.str.unstar:d.str.star;a(d.starlink).find("span.media-body").text(b)},d.textToBase=function(){var b=d.courseState?d.str.starred:d.str.unstarred;a(d.starlink).find("span.media-body").text(b)},d.iconReverse=function(){d.iconDisplay(!d.courseState)},d.iconToBase=function(){d.iconDisplay(d.courseState)},d.getCourseState=function(){var b=a(d.starlink).find("img.icon"),c=a(b).attr("src"),e=c.match(/^(.*\/)(star|star-o)$/),f=a(d.starlink).find("span.media-body").text();return"star"===e[2]&&f===d.str.starred||("star-o"!==e[2]||f!==d.str.unstarred)&&null},d.setCourseState=function(a){d.courseState=a,d.iconToBase(),d.textToBase()},d.main=function(){d.starlink=a("a[data-key='starlink']"),d.currentCourseID=a("body").attr("class").match(/(^|\s)course-(\d+)($|\s)/)[2],d.courseState=d.getCourseState(),d.ajaxActive=!1,a("a[data-key='starlink']").on({mouseenter:function(){d.iconReverse(),d.textAction()},mouseleave:function(){d.ajaxActive||(d.iconToBase(),d.textToBase())},click:function(a){d.ajaxActive=!0,b.call([{methodname:"local_starred_courses_toggle_starred",args:{courseid:d.currentCourseID},done:function(a){d.setCourseState(a),d.ajaxActive=!1}}]),a.stopPropagation()}})},d.maybeMain=function(){"undefined"!=typeof d.str.star&&""!==d.str.star&&"undefined"!=typeof d.str.unstar&&""!==d.str.unstar&&"undefined"!=typeof d.str.starred&&""!==d.str.starred&&"undefined"!=typeof d.str.unstarred&&""!==d.str.unstarred&&d.main()},c.get_string("starlink:actionstar","local_starred_courses").done(function(a){d.str.star=a,d.maybeMain()}),c.get_string("starlink:actionunstar","local_starred_courses").done(function(a){d.str.unstar=a,d.maybeMain()}),c.get_string("starlink:statestarred","local_starred_courses").done(function(a){d.str.starred=a,d.maybeMain()}),c.get_string("starlink:stateunstarred","local_starred_courses").done(function(a){d.str.unstarred=a,d.maybeMain()})}}});